const board = document.getElementById("gameBoard");
const movesDisplay = document.getElementById("moves");
const timeDisplay = document.getElementById("time");
const difficultyDisplay = document.getElementById("difficulty");

let moves = 0;
let matches = 0;
let flippedCards = [];
let timer;
let time = 0;
let difficulty = "easy";

const symbols = ["ðŸŽ","ðŸŒ","ðŸ‡","ðŸ“","ðŸ’","ðŸ¥","ðŸ","ðŸ¥¥","ðŸ‘","ðŸ‰","ðŸ¥­","ðŸ‹"];

function startTimer() {
    timer = setInterval(() => {
        time++;
        timeDisplay.textContent = time;
    }, 1000);
}

function stopTimer() {
    clearInterval(timer);
}

function shuffle(array) {
    for (let i = array.length - 1; i > 0; i--) {
        let j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
    }
    return array;
}

function getGridSize() {
    if (difficulty === "easy") return 4;
    if (difficulty === "medium") return 6;
    return 8;
}

function generateBoard() {
    board.innerHTML = "";
    moves = 0;
    matches = 0;
    time = 0;
    movesDisplay.textContent = moves;
    timeDisplay.textContent = time;
    stopTimer();
    startTimer();

    const size = getGridSize();
    board.style.gridTemplateColumns = `repeat(${size}, 80px)`;

    const totalCards = size * size;
    const selectedSymbols = symbols.slice(0, totalCards / 2);
    const cards = shuffle([...selectedSymbols, ...selectedSymbols]);

    cards.forEach(symbol => {
        const card = document.createElement("div");
        card.classList.add("card");
        card.dataset.symbol = symbol;
        card.textContent = symbol;
        card.addEventListener("click", flipCard);
        board.appendChild(card);
    });
}

function flipCard() {
    if (flippedCards.length === 2 || this.classList.contains("flipped")) return;

    this.classList.add("flipped");
    flippedCards.push(this);

    if (flippedCards.length === 2) {
        moves++;
        movesDisplay.textContent = moves;
        checkMatch();
    }
}

function checkMatch() {
    const [card1, card2] = flippedCards;

    if (card1.dataset.symbol === card2.dataset.symbol) {
        matches++;
        flippedCards = [];

        if (matches === (getGridSize() * getGridSize()) / 2) {
            stopTimer();
            adjustDifficulty();
            setTimeout(generateBoard, 2000);
        }

    } else {
        setTimeout(() => {
            card1.classList.remove("flipped");
            card2.classList.remove("flipped");
            flippedCards = [];
        }, 800);
    }
}

function adjustDifficulty() {
    const accuracy = matches / moves;

    if (accuracy > 0.8 && time < 60) {
        difficulty = "hard";
    } else if (accuracy > 0.6) {
        difficulty = "medium";
    } else {
        difficulty = "easy";
    }

    difficultyDisplay.textContent =
        difficulty.charAt(0).toUpperCase() + difficulty.slice(1);
}

function restartGame() {
    generateBoard();
}

function toggleTheme() {
    document.body.classList.toggle("dark");
}

generateBoard();
